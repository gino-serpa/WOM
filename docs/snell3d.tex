\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\begin{document}
Since the refracted ray should be in the plane defined by the incident ray and the normal we should be able to express it as:

\begin{equation}
\hat r_r = \alpha  \hat k + \beta \hat r_i
\end{equation}

where $\alpha$ and $\beta$ are scalars and the unit vectors $\hat k$ and $\hat r_i$ are the normal to the surface and incident vector respectively.
In order to obtain $\alpha$ and $\beta$ note that $\hat r_r$ should be a unit vector, therefore:

\begin{equation} \label{eq:unity}
\alpha^2 + \beta^2 + 2 \alpha \beta (\hat k \cdot \hat r_i) = 1 
\end{equation}

Now we can get an expression for $\alpha$ from the expression of the cosine of the refracted angle:

\begin{align}
-\hat k \cdot \hat r_r              & = \cos\theta_r \nonumber \\
(-\hat k)\cdot (\alpha \hat k +\beta \hat r_i)  
                                    & = \cos\theta_r \nonumber \\
-\alpha-\beta (\hat k\cdot \hat r_i)           
                                    & = \cos\theta_r \nonumber \\
\alpha                              & 
                           = -\cos\theta_r -\beta(\hat k \cdot \hat r_i) 
\end{align}

replacing this in (\ref{eq:unity}) we obtain:

\[
(- \cos\theta_r - \beta (\hat k \cdot \hat r_i))^2+ \beta^2 + 2(-\cos\theta_r-\beta(\hat k\cdot \hat r_i))\beta(\hat k \cdot \hat r_i)=1
\]

\[
(1-(\hat k\cdot \hat r_i)^2)\beta^2 = 1-\cos^2\theta_r
\]

\[
\beta = + \sqrt{\dfrac{1-\cos^2\theta_r}{1-(\hat k \cdot \hat r_i)^2}}
= \dfrac{\sin\theta_r}{\sin\theta_i}
\]


but from Snell $n_i \sin\theta_i = n_r \sin \theta_r$ and we obtain an expression for $beta$:

\begin{equation}
\beta = \dfrac{n_i}{n_r}
\end{equation}


So that $\hat r_r$ can be now expressed as:
\begin{equation}
\hat r_r = 
\left( -\cos\theta_r - \left( \dfrac{n_i}{n_r}\right) (\hat r_i \cdot \hat k) \right) \hat k + 
\dfrac{n_i}{n_r} \hat r_i
\end{equation}


with $\cos\theta_r$ expressed by:
\begin{equation}
\cos\theta_r 
     = 
\sqrt{
      1 - 
      \left(\dfrac{n_i}{n_r}\right)^2 \left(1-\left(\hat r_i \cdot \hat k\right)^2 \right)
}
\end{equation}



\end{document}
